<!DOCTYPE html>
<html>
<head>
  	<meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
	<link type="text/css" rel="stylesheet" href="../../css/main.css"/>
	<link type="text/css" rel="stylesheet" href="../../css/theme-bright.css"/>
	<link type="text/css" rel="stylesheet" href="../../css/labeling.css"/>
    <link type="text/css" rel="stylesheet" href="../../css/labeling-new-boxmodel.css"/>
    <link type="text/css" rel="stylesheet" href="../../css/labeling-webkit-old-boxmodel.css"/>
	<script type="text/javascript" src="../../js/d3.min.js"></script>
    <!-- >script type="text/javascript" src="../../js/d3.layout.js"></script--> <!-- causes conflicts when imported -->
    <!-- own plugins to handle AVM based on D3.js -->
    <script type="text/javascript" src="../../js/ogvic.js"></script>
    <script type="text/javascript" src="../../js/ogvic.d3.utils.js"></script>
    <script type="text/javascript" src="../../js/circle-packing-zoomable.js"></script>
	<style type="text/css">
	
	
	.node {
	  cursor: pointer;
	}
	
	.label,
	.node--root {
	  pointer-events: none;
	}	
	
	.node--leaf {
	  pointer-events: all; /* problem: when leafs are clickable, we zoom into them instead of showing them (with a label) */
	  /*pointer-events: none;*/ /* problem: prevents identity highlighting of leaf nodes */
	}
	
	</style>
</head>
<body>

<script type="text/javascript">


/******************/
/* SETTINGS       */
/******************/


      // force-directed-graph
      var lineWidth = 7,
      	markerWidth = 3,
          markerHeight = 3,
          cRadius = 10,
		refX = cRadius + (markerWidth * 1.3) + 0.155 * cRadius, /* works well for stroke widths between 5 and 20 */
		// ALT refX = cRadius + (markerWidth * 1.5), 
		// ALT3 refX = cRadius + (markerWidth * 2),
		// ALT1: refX = cRadius + markerWidth * Math.sqrt(lineWidth) ,
		refY = - (cRadius*cRadius) / 375,  /* works well for stroke widths between 5 and 20 */
		// ALT1: refY = -Math.sqrt(cRadius),
		// ALT2: refY = -Math.sqrt(cRadius) * 0.8 + 20/lineWidth, /* works well for stroke width 7px */
          drSub = cRadius + refY, /* works well for stroke widths between 5 and 20 */
		ICONSIZE = 0 // TODO does not actually work. hack!
      	;
    

	
/******************************/
/* BASIC PAGE BUILDING        */
/******************************/

		var visContainer;
        var vis;
		var labelContainerSpace;

		visContainer = d3.select("body").append("div");
		
        var svg = visContainer.append("svg:svg")
    	.style("z-index", -1)
   		.attr("id", "svg")
        .attr("width", width)
        .attr("height", height);
    
        
        clearVis = function() {
        	vis.remove();
        	//vis.selectAll("*").remove();
        	labelContainerSpace.remove();
        }
        
        initContainers = function() {
	        	
	        vis = svg
	 	        .append("svg:g")
		//     .attr("width", outerDiameter)
		//     .attr("height", outerDiameter)
	 	        .attr("transform", "translate(" + m[3] + "," + m[0] + ")")
	 	        ;
	
	 		labelContainerSpace = visContainer.append("div")
	 			.attr("id", "labelContainerSpace")
	 			.style("margin-top", m[0]+"px")
	 			.style("margin-left", m[3]+"px")
	 		    .attr("width", width + "px")
	 		    .attr("height", height + "px");
        }
        
        reInitContainers = function() {
        	clearVis();
        	initContainers();
        }
		
		//var mInfo = d3.select("body").append("div");
		
		initContainers();
		
        // Define Markers to be used in arrow paths
       svg.avmProvideMarkerCollection();


//  vis = d3.select("body").append("svg")
//     .attr("width", outerDiameter)
//     .attr("height", outerDiameter)
//   .append("g")
//     .attr("transform", "translate(" + margin + "," + margin + ")");



//var mInfo = d3.select("body").append("div");

	
/**************************/
/* START DATA DRIVE       */
/**************************/


// 			var data = [],
// 			    t = 0;
// 			var interval = setInterval(function() {
// 			    $.getJSON("path/to/data.json", function(datum) {
// 			        data.push({time: ++t, value: datum});
// 			        redraw();
// 			    });
// 			}, 1000);

	
		
afterLoading = loadCirclePackingZoomable;

reLoad = function() {
	d3.json("http://localhost:8080/semvis/projects/latest", afterLoading);
}

loadProject = function(projectID) {
	d3.json("http://localhost:8080/semvis/projects/run/" + projectID, afterLoading);
}

d3.select(self.frameElement).style("height", outerDiameter + "px");

reLoad();

</script>

<button onclick="reLoad()">Reload</button>

<button onclick="loadProject('containment-test')">load containment-test</button>
<button onclick="loadProject('po-9-containment')">load po-9-containment</button>

 <!-- somehow MUST NOT be before the script! -->
        <svg id="svg-effects">
            <filter id="blur-effect-1">
                <feGaussianBlur stdDeviation="0.9" />
            </filter>
            <filter id="blur-effect-2">
                <feGaussianBlur stdDeviation="2" />
            </filter>
             <!-- causes circle-packing to zoom wrongly -->
<!--             <defs> -->
<!--                 <marker id="markerSquare" markerWidth="7" markerHeight="7" refx="4" refy="4" orient="auto"> -->
<!--                     <rect x="1" y="1" width="5" height="5" style="stroke: none; fill:#000000;"/> -->
<!--                 </marker> -->
<!--                 <marker id="markerArrow" markerWidth="13" markerHeight="13" refx="2" refy="7" orient="auto"> -->
<!--                     <path d="M2,2 L2,13 L8,7 L2,2" style="fill: #000000;"/> -->
<!--                 </marker> -->
<!--             </defs> -->
        </svg>

</body>
</html>
